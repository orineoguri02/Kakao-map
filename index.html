<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>카카오맵 WebView 연동</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    #map { width:100%; height:100vh; }
    .overlay { position:absolute; top:10px; left:10px; background:#fff; padding:6px; border-radius:4px; box-shadow:0 0 5px rgba(0,0,0,0.2); }
  </style>
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_JS_KEY&libraries=services,clusterer"></script>
</head>
<body>
  <div id="map"></div>
  <div class="overlay" id="status">로딩...</div>

  <script>
    let map;
    const statusEl = document.getElementById('status');

    function initMap(lat = 37.5665, lng = 126.9780) {
      const container = document.getElementById('map');
      const options = {
        center: new kakao.maps.LatLng(lat, lng),
        level: 4
      };
      map = new kakao.maps.Map(container, options);

      // 마커
      const marker = new kakao.maps.Marker({
        position: new kakao.maps.LatLng(lat, lng)
      });
      marker.setMap(map);
      statusEl.textContent = `현재 중심: ${lat.toFixed(5)}, ${lng.toFixed(5)}`;
    }

    // React Native에서 메시지 받음
    window.onload = () => {
      initMap();

      // RN이 보낸 메시지 처리
      window.addEventListener('message', (e) => {
        try {
          const msg = JSON.parse(e.data);
          if (msg.type === 'setLocation') {
            initMap(msg.lat, msg.lng);
          } else if (msg.type === 'searchKeyword') {
            const ps = new kakao.maps.services.Places();
            ps.keywordSearch(msg.keyword, (data, status) => {
              if (status === kakao.maps.services.Status.OK) {
                const first = data[0];
                map.setCenter(new kakao.maps.LatLng(first.y, first.x));
                new kakao.maps.Marker({
                  position: new kakao.maps.LatLng(first.y, first.x),
                  map: map
                });
                sendToRN({ type: 'searchResult', name: first.place_name, address: first.address_name });
              } else {
                sendToRN({ type: 'searchResult', error: status });
              }
            });
          }
        } catch (err) {
          console.warn('파싱 실패', err);
        }
      });
    };

    function sendToRN(payload) {
      // React Native WebView와 호환되도록
      if (window.ReactNativeWebView && window.ReactNativeWebView.postMessage) {
        window.ReactNativeWebView.postMessage(JSON.stringify(payload));
      } else {
        // fallback for older bridge
        window.parent.postMessage(JSON.stringify(payload), '*');
      }
    }
  </script>
</body>
</html> 